<!DOCTYPE html>
<html>
<head>
    <title>Test Departments Fetch</title>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        // Replace with your actual values
        const supabaseUrl = 'https://jiwuzdphmcuzaztunijv.supabase.co'
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imppd3V6ZHBobWN1emF6dHVuaWp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2OTk2MzAsImV4cCI6MjA3MTI3NTYzMH0.gN3mbousxL7nW0apwB1pnQHqNe2QJlQ6rE2OtikiaY8'

        const supabase = createClient(supabaseUrl, supabaseAnonKey)

        async function testDepartments() {
            console.log('Testing departments fetch...')
            
            // Test 1: Basic fetch
            const { data, error } = await supabase
                .from('departments')
                .select('*')
            
            console.log('Result:', { data, error })
            
            if (error) {
                document.getElementById('result').innerHTML = `
                    <h3 style="color: red;">Error:</h3>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                `
            } else {
                document.getElementById('result').innerHTML = `
                    <h3 style="color: green;">Success!</h3>
                    <p>Found ${data.length} departments:</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `
            }
            
            // Test 2: Check if we can insert (to test permissions)
            console.log('Testing if we can query the table...')
            const { count, error: countError } = await supabase
                .from('departments')
                .select('*', { count: 'exact', head: true })
            
            console.log('Count result:', { count, countError })
        }

        // Run test when page loads
        window.addEventListener('load', testDepartments)
    </script>
</head>
<body>
    <h1>Testing Departments Fetch</h1>
    <p>Check the browser console for details</p>
    <div id="result">Loading...</div>
</body>
</html>